---
title: Tests workflow
---
flowchart TD
  %% nodes
  start([demo/e2e/hack/run-test.sh])
  buildImages[ðŸ§° Build images]
  createManagementCluster["ðŸ§° Create or Cleanup 
    Management Cluster (ClusterAPI)"]
  preFolder[ðŸ§° Prepare 'demo/.tmp/tests/pre' tests folder]
  prepareBaseTestFolder[Prepare 'demo/.tmp/tests/base' test folder]
  prepareRunTestFolder[ðŸª Prepare run's folder 'demo/.tmp/tests/runs/$SCENARIO_ID']
  runInParallel[[Run in parallel]]
  prepareNamespaceInManagementCluster[ðŸª Prepare auxiliary namespace in Management cluster]
  injectManagementClusterInContext[ðŸª Inject Management cluster in context]
  injectClusterAPIProvisionerInContext["ðŸª Inject cluster provisioner (ClusterAPI) in context"]
  isDedicatedClusterRequired1{{Is Dedicated Cluster required?}}
  injectManagementAsDedicatedInContext["ðŸª Create scenario namespace in Management cluster"]
  injectManagementClientInContext["ðŸª Inject namespace-scoped client in context"]
  createDedicatedCluster[ðŸª Create dedicated cluster]
  injectDedicatedCluster[ðŸª Inject cluster-scoped client in context]
  setScenarioTimeout[ðŸª set timeout for scenario]
  runScenario[[Run Scenario]]
  deleteDedicatedCluster[ðŸª Unprovision Dedicated Clusters if any]
  deleteManagementClusterNamespace[ðŸª Delete Scenario Namespaces in Management Cluster]
  waitTests[[Wait for all scenarios to complete]]
  finish(((end)))

  %% links
  start --> buildImages
  start --> createManagementCluster
  start --> preFolder
  buildImages --> prepareBaseTestFolder
  preFolder --> prepareBaseTestFolder
  createManagementCluster --> prepareBaseTestFolder
  prepareBaseTestFolder --> runInParallel
  runInParallel --> prepareRunTestFolder
  prepareRunTestFolder --> injectManagementClusterInContext
  injectManagementClusterInContext --> prepareNamespaceInManagementCluster
  prepareNamespaceInManagementCluster --> injectClusterAPIProvisionerInContext
  injectClusterAPIProvisionerInContext --> isDedicatedClusterRequired1
  isDedicatedClusterRequired1 --> |yes| createDedicatedCluster
  isDedicatedClusterRequired1 --> |no| injectManagementAsDedicatedInContext
  injectManagementAsDedicatedInContext --> injectManagementClientInContext
  injectManagementClientInContext --> setScenarioTimeout
  createDedicatedCluster --> injectDedicatedCluster
  injectDedicatedCluster --> setScenarioTimeout
  setScenarioTimeout --> runScenario
  runScenario --> deleteDedicatedCluster
  deleteDedicatedCluster --> deleteManagementClusterNamespace
  deleteManagementClusterNamespace --> waitTests
  waitTests --> finish

